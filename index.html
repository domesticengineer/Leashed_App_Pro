<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pet Advocate Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
  <style>
    /* Your existing CSS styles go here */
    .fc { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background-color: #fff; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); } .fc .fc-toolbar { background-color: #f5f5f5; border-bottom: 1px solid #e0e0e0; padding: 10px; justify-content: space-between; } .fc .fc-daygrid-day { border: 1px solid #e0e0e0; } .fc .fc-event { border-radius: 4px; padding: 2px 4px; font-size: 12px; white-space: normal; } .fc .fc-event-main { overflow: hidden; text-overflow: ellipsis; } .fc .fc-timegrid-event { min-height: 1.5em; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen font-sans">
  <div id="modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center hidden"> <div class="bg-white p-6 rounded-lg shadow-md"> <p id="modal-message" class="mb-4"></p> <button id="modal-confirm" class="bg-blue-500 text-white px-4 py-2 rounded-md mr-2">Confirm</button> <button id="modal-cancel" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-md">Cancel</button> </div> </div> <div id="toast" class="fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-md shadow-md hidden"> <span id="toast-message"></span> </div> <div id="login" class="container mx-auto p-4"> <div class="bg-white rounded-lg shadow-md p-6 max-w-md mx-auto"> <h1 class="text-2xl font-bold text-gray-800 mb-4">Pet Advocate Portal Login</h1> <div id="login-error" class="text-red-500 text-sm mb-4 hidden"></div> <div class="mb-4"> <label for="username" class="block text-gray-700">Username</label> <input id="username" type="text" placeholder="Enter username" class="w-full p-2 border border-gray-300 rounded-md" required> </div> <div class="mb-4"> <label for="password" class="block text-gray-700">Password</label> <input id="password" type="password" placeholder="Enter password" class="w-full p-2 border border-gray-300 rounded-md" required> </div> <button id="login-button" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600" onclick="handleLogin()">Login</button> </div> </div> <div id="admin" class="container mx-auto p-4 hidden"> <div class="flex justify-between items-center mb-4"> <h1 class="text-2xl font-bold text-gray-800">Admin Dashboard</h1> <button class="bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600" onclick="handleLogout()">Logout</button> </div> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"> <div class="bg-white rounded-lg shadow-md p-6"> <h2 class="text-xl font-semibold text-gray-800 mb-4">Create New Pet Advocate</h2> <div id="advocate-error" class="text-red-500 text-sm mb-4 hidden"></div> <div class="mb-4"> <label for="new-firstname" class="block text-gray-700">First Name</label> <input id="new-firstname" type="text" placeholder="First Name" class="w-full p-2 border border-gray-300 rounded-md" required> </div> <div class="mb-4"> <label for="new-lastname" class="block text-gray-700">Last Name</label> <input id="new-lastname" type="text" placeholder="Last Name" class="w-full p-2 border border-gray-300 rounded-md" required> </div> <div class="mb-4"> <label for="new-email" class="block text-gray-700">Email</label> <input id="new-email" type="email" placeholder="Email" class="w-full p-2 border border-gray-300 rounded-md" required> </div> <div class="mb-4"> <label for="new-phone" class="block text-gray-700">Phone Number</label> <input id="new-phone" type="tel" placeholder="XXX-XXX-XXXX" class="w-full p-2 border border-gray-300 rounded-md" required> </div> <div class="mb-4"> <label for="new-username" class="block text-gray-700">Username</label> <input id="new-username" type="text" placeholder="Username" class="w-full p-2 border border-gray-300 rounded-md" required> </div> <div class="mb-4"> <label for="new-password" class="block text-gray-700">Password</label> <input id="new-password" type="password" placeholder="Password" class="w-full p-2 border border-gray-300 rounded-md" required> </div> <button id="create-advocate-button" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600" onclick="createPetAdvocate()">Create Pet Advocate</button> </div> <div class="bg-white rounded-lg shadow-md p-6"> </div> </div> <div class="bg-white rounded-lg shadow-md p-6 mt-4"> <h2 class="text-xl font-semibold text-gray-800">Pet Advocates</h2> <ul id="admin-users" class="space-y-4"></ul> </div> </div> <div id="pet-advocate" class="container mx-auto p-4 hidden"> </div>

  <script>
    // =================================================================
    // IMPORTANT: PASTE YOUR PYTHON BACKEND URL HERE
    // =================================================================
   const API_BASE_URL = '/api'; // <-- REPLACE THIS
    // =================================================================

    let currentUser = null;

    // --- UI & Utility Functions ---
    function showToast(message, isError = false) { const toast = document.getElementById('toast'); document.getElementById('toast-message').textContent = message; toast.className = `fixed top-4 right-4 text-white px-4 py-2 rounded-md shadow-md ${isError ? 'bg-red-500' : 'bg-green-500'}`; toast.classList.remove('hidden'); setTimeout(() => toast.classList.add('hidden'), 3000); }
    function showSection(sectionId) { ['login', 'admin', 'pet-advocate'].forEach(id => { document.getElementById(id).classList.toggle('hidden', id !== sectionId); }); }

    // --- Core Application Logic ---
    async function apiRequest(endpoint, method = 'GET', body = null) {
        try {
            const options = {
                method,
                headers: { 'Content-Type': 'application/json' },
            };
            if (body) {
                options.body = JSON.stringify(body);
            }
            const response = await fetch(`${API_BASE_URL}${endpoint}`, options);
            const data = await response.json();
            if (!response.ok) {
                throw new Error(data.message || 'An API error occurred');
            }
            return data;
        } catch (error) {
            showToast(error.message, true);
            throw error; // Propagate the error to be caught by the caller
        }
    }

    async function handleLogin() {
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;
        const errorDiv = document.getElementById('login-error');
        errorDiv.classList.add('hidden');

        try {
            const data = await apiRequest('/login', 'POST', { username, password });
            currentUser = data.user;
            alert("Logged in as: " + currentUser.role);
            
            if (currentUser.role === 'admin') {
                showSection('admin');
                renderAdminDashboard();
            } else {
                showSection('pet-advocate');
                // renderPetAdvocateDashboard();
            }
            showToast('Login successful');
        } catch (error) {
            errorDiv.textContent = 'Invalid username or password';
            errorDiv.classList.remove('hidden');
        }
    }

    async function createPetAdvocate() {
        const errorDiv = document.getElementById('advocate-error');
        errorDiv.classList.add('hidden');
        
        const newUser = {
            firstName: document.getElementById('new-firstname').value.trim(),
            lastName: document.getElementById('new-lastname').value.trim(),
            email: document.getElementById('new-email').value.trim(),
            phone: document.getElementById('new-phone').value.trim(),
            username: document.getElementById('new-username').value.trim(),
            password: document.getElementById('new-password').value,
        };

        if (!newUser.username || !newUser.password || !newUser.email) {
            errorDiv.textContent = 'Username, password, and email are required.';
            errorDiv.classList.remove('hidden');
            return;
        }
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(newUser.email)) {
             errorDiv.textContent = 'Invalid email format.';
             errorDiv.classList.remove('hidden');
             return;
        }
        const phoneRegex = /^\d{3}-\d{3}-\d{4}$/;
        if (!phoneRegex.test(newUser.phone)) {
            errorDiv.textContent = 'Phone must be in XXX-XXX-XXXX format.';
            errorDiv.classList.remove('hidden');
             return;
        }
        try {
            await apiRequest('/register', 'POST', newUser);
            showToast('Pet Advocate created successfully');
            // Reset form
            ['new-firstname', 'new-lastname', 'new-email', 'new-phone', 'new-username', 'new-password'].forEach(id => document.getElementById(id).value = '');
            renderAdminDashboard(); // Refresh the user list
        } catch (error) {
            errorDiv.textContent = error.message;
            errorDiv.classList.remove('hidden');
        }
    }
    
    function handleLogout() {
        currentUser = null;
        showSection('login');
    }

    async function renderAdminDashboard() {
        try {
            const users = await apiRequest('/users');
            const usersList = document.getElementById('admin-users');
            usersList.innerHTML = '';
            
            const advocates = users.filter(u => u.role === 'pet-advocate');
            if (advocates.length === 0) {
                usersList.innerHTML = '<li>No pet advocates have been created.</li>';
                return;
            }
            
            advocates.forEach(u => {
                usersList.innerHTML += `
                    <li class="p-2 border-b border-gray-200">
                        <div>${u.firstName} ${u.lastName} (${u.username})</div>
                        <div class="text-sm text-gray-600">${u.email}</div>
                    </li>
                `;
            });
        } catch (error) {
            // Error is already shown by apiRequest
        }
           // Load calendar data (from your calendar-data.json or DB)
          const calendarEl = document.getElementById('admin-calendar');
          if (calendarEl) {
            const calendar = new FullCalendar.Calendar(calendarEl, {
              initialView: 'dayGridMonth',
              events: '/api/events'  // You'd need to implement /api/events.js to fetch from DB or JSON
          });
          calendar.render();

            async function renderAdvocateDashboard() {
  // Existing code...
  // Add section for pending requests
  try {
    const pendingRequests = await apiRequest('/requests');
    const requestsList = document.createElement('ul'); // Or use existing div
    requestsList.innerHTML = '';
    pendingRequests.forEach(req => {
      const li = document.createElement('li');
      li.innerHTML = `
        <div>
          <p>${req.service_type} for ${req.client_name} on ${req.preferred_date} at ${req.preferred_time}</p>
          <button onclick="acceptRequest(${req.id})">Accept</button>
        </div>
      `;
      requestsList.appendChild(li);
    });
    document.getElementById('advocate-content').appendChild(requestsList); // Adjust ID as needed
  } catch (err) {}

  // Add section for accepted requests
  try {
    const accepted = await apiRequest(`/requests?userId=${currentUser.id}`);
    // Similar list display...
  } catch (err) {}
}

async function acceptRequest(reqId) {
  try {
    await apiRequest('/accept-request', 'POST', { id: reqId, userId: currentUser.id });
    renderAdvocateDashboard(); // Refresh
    showToast('Request accepted', 'success');
  } catch (err) {
    showToast('Accept failed', 'error');
    <div id="advocate-requests"></div>
  }
}
}
    }
    
    // --- Initial Load ---
    showSection('login');
  </script>
</body>
</html>
